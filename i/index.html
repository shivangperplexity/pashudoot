<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cattle Breed Live Scanner</title>
<style>
  body { font-family: sans-serif; display:flex; flex-direction:column; align-items:center; padding:10px; background:#f0f0f0; }
  video, canvas { border:1px solid #333; max-width:100%; }
  #preprocessedCanvas { margin-top:10px; }
  #logs { max-height:150px; overflow:auto; background:#222; color:#0f0; padding:5px; width:90%; margin-top:10px; font-family:monospace; font-size:0.85rem; }
  #result { margin-top:10px; background:#fff; padding:10px; border-radius:8px; display:none; width:90%; max-width:400px; }
  button { margin-top:10px; padding:8px 12px; font-size:1rem; }
</style>
</head>
<body>

<h1>Cattle Breed Live Scanner</h1>
<video id="video" autoplay muted playsinline></video>
<canvas id="preprocessedCanvas"></canvas>
<div id="logs"></div>

<div id="result">
  <h3 id="resultHeader"></h3>
  <p id="origin"></p>
  <p id="lifespan"></p>
  <p id="milkYield"></p>
  <p id="description"></p>
  <button id="scanAgain">Scan Again</button>
</div>

<script>
const video = document.getElementById("video");
const preprocessedCanvas = document.getElementById("preprocessedCanvas");
const preCtx = preprocessedCanvas.getContext("2d");
const logs = document.getElementById("logs");
const result = document.getElementById("result");
const resultHeader = document.getElementById("resultHeader");
const origin = document.getElementById("origin");
const lifespan = document.getElementById("lifespan");
const milkYield = document.getElementById("milkYield");
const description = document.getElementById("description");
const scanAgainBtn = document.getElementById("scanAgain");

let scanning = true;
let requestInProgress = false;

const breedInfo = {
  "Barbari Goat": {fullName:"Barbari Goat", origin:"Rajasthan, India", lifespan:"10-12 years", milkYield:"1-2 L/day", description:"Small-sized dual-purpose goat."},
  "Bargur Cow": {fullName:"Bargur Cow", origin:"Tamil Nadu, India", lifespan:"15-18 years", milkYield:"3-5 L/day", description:"Draught cattle from hilly areas."},
  "Not Identified": {fullName:"Not Identified", origin:"-", lifespan:"-", milkYield:"-", description:"Breed could not be identified."},
  "Bhadawari Buffalo": {fullName:"Bhadawari Buffalo", origin:"U.P., India", lifespan:"16-20 years", milkYield:"6-10 L/day", description:"Milk with high fat content."},
  "Black Bengal Goat": {fullName:"Black Bengal Goat", origin:"West Bengal, India", lifespan:"8-12 years", milkYield:"1-2 L/day", description:"Known for meat and skin quality."},
  "Hallikar Cow": {fullName:"Hallikar Cow", origin:"Karnataka, India", lifespan:"15-20 years", milkYield:"2-5 L/day", description:"Strong draught breed."},
  "Hariana Cow": {fullName:"Hariana Cow", origin:"Haryana, India", lifespan:"16-20 years", milkYield:"6-10 L/day", description:"Dairy breed with high milk yield."},
  "Holstein Friesian Cow": {fullName:"Holstein Friesian Cow", origin:"Netherlands", lifespan:"18-22 years", milkYield:"20-30 L/day", description:"World's leading dairy breed."},
  "Jamunapari Goat": {fullName:"Jamunapari Goat", origin:"U.P., India", lifespan:"10-12 years", milkYield:"2-3 L/day", description:"Large goat with high milk yield."},
  "Nagori Goat": {fullName:"Nagori Goat", origin:"Rajasthan, India", lifespan:"12-15 years", milkYield:"1-2 L/day", description:"Good draught goat breed."},
  "Osmanabadi Goat": {fullName:"Osmanabadi Goat", origin:"Maharashtra, India", lifespan:"10-12 years", milkYield:"1-2 L/day", description:"Hardy and disease-resistant goat."},
  "Tharparkar Cow": {fullName:"Tharparkar Cow", origin:"Rajasthan, India", lifespan:"15-18 years", milkYield:"10-12 L/day", description:"Dual-purpose heat-tolerant cow."},
  "Deoni Cow": {fullName:"Deoni Cow", origin:"Maharashtra/Karnataka/Andhra Pradesh", lifespan:"12-15 years", milkYield:"3-8 L/day", description:"Dual-purpose cow breed."},
  "Gir Cow": {fullName:"Gir Cow", origin:"Gujarat, India", lifespan:"12-15 years", milkYield:"10-15 L/day", description:"High-quality A2 milk producer."},
  "Guzerat Cow": {fullName:"Guzerat Cow", origin:"Gujarat, India", lifespan:"15-18 years", milkYield:"6-10 L/day", description:"Draught and dairy breed."},
  "Jaffrabadi Buffalo": {fullName:"Jaffrabadi Buffalo", origin:"Gujarat, India", lifespan:"14-18 years", milkYield:"6-10 L/day", description:"Large buffalo, high milk yield."},
  "Jersey Cow": {fullName:"Jersey Cow", origin:"Jersey Island, UK", lifespan:"18-22 years", milkYield:"12-20 L/day", description:"Rich milk producer."},
  "Mehsana Buffalo": {fullName:"Mehsana Buffalo", origin:"Gujarat, India", lifespan:"16-20 years", milkYield:"8-12 L/day", description:"Good dairy buffalo."},
  "Murrah Buffalo": {fullName:"Murrah Buffalo", origin:"Haryana, India", lifespan:"16-20 years", milkYield:"8-12 L/day", description:"High milk-producing buffalo."},
  "Nili Ravi Buffalo": {fullName:"Nili Ravi Buffalo", origin:"Pakistan", lifespan:"14-18 years", milkYield:"7-12 L/day", description:"Famous dairy buffalo breed."},
  "Pandharpuri Cow": {fullName:"Pandharpuri Cow", origin:"Maharashtra, India", lifespan:"12-15 years", milkYield:"5-8 L/day", description:"Adapted to drought regions."},
  "Rathi Cow": {fullName:"Rathi Cow", origin:"Rajasthan, India", lifespan:"15-20 years", milkYield:"8-10 L/day", description:"Heat-tolerant dairy cow."},
  "Red Sindhi Cow": {fullName:"Red Sindhi Cow", origin:"Sindh (Pakistan/India)", lifespan:"12-15 years", milkYield:"8-12 L/day", description:"Good milk yield, heat-tolerant."},
  "Sahiwal Cow": {fullName:"Sahiwal Cow", origin:"Punjab region", lifespan:"12-15 years", milkYield:"12-18 L/day", description:"Heat-tolerant dairy breed."},
  "Sirohi Cow": {fullName:"Sirohi Cow", origin:"Rajasthan, India", lifespan:"10-12 years", milkYield:"1-2 L/day", description:"Good meat and milk producer."},
  "Vechur Cow": {fullName:"Vechur Cow", origin:"Kerala, India", lifespan:"15-18 years", milkYield:"2-3 L/day", description:"Smallest cow breed, hardy."}
};

// logs
function log(msg){
  logs.textContent += msg+"\n";
  logs.scrollTop = logs.scrollHeight;
}

// start camera
async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio:false });
    video.srcObject = stream;
    video.onloadedmetadata = ()=> video.play();
  } catch(e){
    console.error("Camera error:", e);
    log("Camera error: "+e);
  }
}
startCamera();

// preprocess frame
async function getFrameBlob(){
  const tmpCanvas = document.createElement("canvas");
  const tmpCtx = tmpCanvas.getContext("2d");
  tmpCanvas.width = video.videoWidth;
  tmpCanvas.height = video.videoHeight;
  tmpCtx.drawImage(video,0,0);
  const imgData = tmpCtx.getImageData(0,0,tmpCanvas.width,tmpCanvas.height).data;

  // crop black borders
  let minX=tmpCanvas.width, minY=tmpCanvas.height, maxX=0, maxY=0;
  for(let y=0;y<tmpCanvas.height;y++){
    for(let x=0;x<tmpCanvas.width;x++){
      const i=(y*tmpCanvas.width+x)*4;
      if(imgData[i]+imgData[i+1]+imgData[i+2]>30){ // non-black
        if(x<minX) minX=x;
        if(x>maxX) maxX=x;
        if(y<minY) minY=y;
        if(y>maxY) maxY=y;
      }
    }
  }
  const cw=maxX-minX, ch=maxY-minY;
  tmpCanvas.width=cw; tmpCanvas.height=ch;
  tmpCtx.drawImage(video,minX,minY,cw,ch,0,0,cw,ch);

  // resize
  const outCanvas=document.createElement("canvas");
  const scale=320/cw;
  outCanvas.width=320; outCanvas.height=ch*scale;
  const outCtx=outCanvas.getContext("2d");
  outCtx.filter="contrast(1.2) brightness(1.1)";
  outCtx.drawImage(tmpCanvas,0,0,outCanvas.width,outCanvas.height);

  preprocessedCanvas.width=outCanvas.width;
  preprocessedCanvas.height=outCanvas.height;
  preCtx.drawImage(outCanvas,0,0);

  return new Promise(resolve=>outCanvas.toBlob(resolve,"image/jpeg"));
}

// simulate detection API
async function detectCattle(blob){
  await new Promise(r=>setTimeout(r,200));
  return "LABEL_1"; // only proceed if LABEL_1
}

// simulate breed API
async function detectBreed(blob){
  await new Promise(r=>setTimeout(r,300));
  return "Barbari Goat"; // pretend breed
}

// show result
function showResult(breed){
  const info=breedInfo[breed]||breedInfo["Not Identified"];
  resultHeader.textContent=`âœ… Breed Detected: ${breed}`;
  origin.textContent=`Origin: ${info.origin}`;
  lifespan.textContent=`Lifespan: ${info.lifespan}`;
  milkYield.textContent=`Milk Yield: ${info.milkYield}`;
  description.textContent=`About: ${info.description}`;
  result.style.display="block";
}

// scan again
scanAgainBtn.addEventListener("click",()=>{
  result.style.display="none";
  scanning=true;
});

// live scan
async function liveScan(){
  if(!scanning || requestInProgress){
    requestAnimationFrame(liveScan);
    return;
  }
  requestInProgress=true;
  const blob=await getFrameBlob();
  const label=await detectCattle(blob);
  log(`Detection: ${label}`);
  if(label==="LABEL_1"){
    const breed=await detectBreed(blob);
    log(`Breed detected: ${breed}`);
    showResult(breed);
    scanning=false; // freeze frame
  }
  requestInProgress=false;
  setTimeout(()=>requestAnimationFrame(liveScan),500);
}
liveScan();
</script>
</body>
</html>
