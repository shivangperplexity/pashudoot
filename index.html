<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cattle Breed Identifier</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #fde2e4, #e2f0cb, #cddafd);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      font-family: 'Inter', sans-serif;
      margin: 0;
    }
    h1 { font-size: 2rem; margin-bottom: 20px; font-weight: 700; color: #6a1b9a; text-align: center; }
    .upload-container {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 90%;
      max-width: 340px;
      height: 200px;
      background: rgba(255, 255, 255, 0.6);
      border: 2px dashed #6a1b9a;
      border-radius: 16px;
    }
    .upload-icon { width: 40px; height: 40px; margin-bottom: 8px; stroke: #6a1b9a; }
    .upload-text { color: #333; font-size: 1rem; font-weight: 600; }
    input[type="file"] { display: none; }

    .result { margin-top: 20px; max-width: 700px; width: 100%; }
    .card {
      margin-bottom: 16px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      overflow: hidden;
      transition: transform 0.3s;
    }
    .card:hover { transform: scale(1.02); }
    .card-header {
      background: linear-gradient(135deg, #6a1b9a, #d81b60);
      color: white;
      padding: 10px;
      font-weight: 600;
    }
    .card-body { padding: 12px 16px; }
    .card-body p { margin: 6px 0; }
    .debug { margin-top: 20px; background: #222; color: #0f0; padding: 12px; border-radius: 12px; font-size: 0.85rem; font-family: monospace; white-space: pre-wrap; display:none; }
    .debug.visible { display: block; }
  </style>
</head>
<body>
  <h1>Cattle Breed Identifier</h1>

  <label class="upload-container">
    <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
      <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
    </svg>
    <span class="upload-text">Upload Images</span>
    <input type="file" accept="image/*" id="imageUpload" multiple>
  </label>

  <div id="result" class="result"></div>
  <div id="debug" class="debug"></div>

<script>
const resultBox = document.getElementById("result");
const debugBox = document.getElementById("debug");

const breedInfo = {
  "hallikar": {origin:"Karnataka, India", lifespan:"15-20 years", milkYield:"2-5 liters/day", description:"Known for strength and draught ability."},
  "deoni": {origin:"Maharashtra, Karnataka, Andhra Pradesh", lifespan:"12-15 years", milkYield:"3-8 liters/day", description:"Dual-purpose breed with good resistance."},
  "gir": {origin:"Gujarat, India", lifespan:"12-15 years", milkYield:"10-15 liters/day", description:"Famous for high-quality A2 milk."},
  "jersey": {origin:"Jersey Island, UK", lifespan:"18-22 years", milkYield:"12-20 liters/day", description:"Popular dairy breed producing rich milk."},
  "red sindhi": {origin:"Sindh (Pakistan/India)", lifespan:"12-15 years", milkYield:"8-12 liters/day", description:"Good yield and adaptability."},
  "sahiwal": {origin:"Punjab region", lifespan:"12-15 years", milkYield:"12-18 liters/day", description:"Heat-tolerant and productive."}
};

function showDebug(label, json) {
  debugBox.classList.add("visible");
  debugBox.textContent += `\n=== ${label} ===\n${JSON.stringify(json, null, 2)}\n`;
}

document.getElementById("imageUpload").addEventListener("change", async (e) => {
  const files = e.target.files;
  if (!files.length) return;

  resultBox.innerHTML = "";
  debugBox.textContent = "";

  for (let file of files) {
    const formData = new FormData();
    formData.append("files", file);

    try {
      // STEP 1: Detection
      const detectResponse = await fetch("https://shivangggg-class.hf.space/predict", {
        method: "POST",
        body: formData
      });
      const detectData = await detectResponse.json();
      showDebug("Detection API Response", detectData);

      const detectResult = Array.isArray(detectData) ? detectData[0] : detectData;

      let cardHTML = `
        <div class="card">
          <div class="card-header">${file.name}</div>
          <div class="card-body">
            <p><strong>Decision:</strong> ${detectResult.decision}</p>
            <p><strong>Class:</strong> ${detectResult.class}</p>
            <p><strong>Confidence:</strong> ${(detectResult.confidence*100).toFixed(2)}%</p>
      `;

      // STEP 2: If accepted, call breed API
      if (detectResult.decision === "accept") {
        const breedForm = new FormData();
        breedForm.append("files", file);

        const breedResponse = await fetch("https://shivangggg-cow-breed-classifier.hf.space/predict", {
          method: "POST",
          body: breedForm
        });
        const breedData = await breedResponse.json();
        showDebug("Breed API Response", breedData);

        if (Array.isArray(breedData) && breedData.length > 0) {
          const breedTop = breedData[0];
          const key = breedTop.class.toLowerCase();
          const formattedBreed = key.charAt(0).toUpperCase() + key.slice(1);
          const info = breedInfo[key] || {origin:"-", lifespan:"-", milkYield:"-", description:"No info available"};

          cardHTML += `
            <hr>
            <p><strong>Breed:</strong> ${formattedBreed} (${(breedTop.confidence*100).toFixed(1)}%)</p>
            <p><strong>Origin:</strong> ${info.origin}</p>
            <p><strong>Lifespan:</strong> ${info.lifespan}</p>
            <p><strong>Milk Yield:</strong> ${info.milkYield}</p>
            <p><strong>About:</strong> ${info.description}</p>
          `;
        }
      }

      cardHTML += "</div></div>";
      resultBox.innerHTML += cardHTML;

    } catch (err) {
      console.error("Error:", err);
      resultBox.innerHTML += `
        <div class="card">
          <div class="card-header">${file.name}</div>
          <div class="card-body">
            <p style="color:red;">⚠️ Error: Could not process this file.</p>
          </div>
        </div>
      `;
    }
  }
});
</script>
</body>
</html>
