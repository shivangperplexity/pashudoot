<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cattle Breed Identifier</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  min-height: 100vh;
  background: linear-gradient(135deg, #fde2e4, #e2f0cb, #cddafd);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  font-family: 'Inter', sans-serif;
  margin: 0;
}
h1 { font-size: 2rem; margin-bottom: 20px; font-weight: 700; color: #6a1b9a; animation: fadeInDown 0.8s ease-out; text-align: center; }

.upload-container {
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 90%;
  max-width: 340px;
  height: 200px;
  background: rgba(255, 255, 255, 0.6);
  border: 2px dashed #6a1b9a;
  border-radius: 16px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.upload-container:hover { transform: scale(1.03); box-shadow: 0 8px 16px rgba(106, 27, 154, 0.3); }
.upload-icon { width: 40px; height: 40px; margin-bottom: 8px; animation: pulse 1.5s infinite ease-in-out; stroke: #6a1b9a; }
.upload-text { color: #333; font-size: 1rem; font-weight: 600; }
input[type="file"] { display: none; }

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(4px);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  text-align: center;
  padding: 20px;
}
.overlay.visible { display: flex; }
.overlay img { transform: scale(2); margin-bottom: 20px; animation: float 2s ease-in-out infinite; }
.progress-texts { display: flex; flex-direction: column; align-items: center; gap: 8px; margin-bottom: 15px; }
.progress-texts p { font-size: 1.1rem; font-weight: 600; opacity: 0.4; transition: all 0.5s ease; color: #444; }
.progress-texts p.active { opacity: 1; color: #6a1b9a; font-size: 1.2rem; }
.progress-bar { width: 80%; max-width: 320px; height: 8px; background: #ddd; border-radius: 6px; overflow: hidden; }
.progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #6a1b9a, #d81b60, #0288d1); border-radius: 6px; transition: width 0.8s ease; }

.result {
  margin-top: 20px;
  max-width: 400px;
  width: 100%;
  background: #fff;
  padding: 0;
  border-radius: 16px;
  box-shadow: 0 6px 16px rgba(106, 27, 154, 0.25);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
  overflow: hidden;
}
.result.visible { opacity: 1; transform: translateY(0); }
.result-header { background: linear-gradient(135deg, #6a1b9a, #d81b60); padding: 12px; text-align: center; color: #fff; font-weight: 700; font-size: 1.4rem; }
.result-body { padding: 16px 20px; }
.result-body p { font-size: 1rem; margin: 10px 0; font-weight: 500; color: #333; }
.result-body strong { color: #6a1b9a; font-weight: 700; }

@keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px);} to {opacity: 1; transform: translateY(0);} }
@keyframes pulse { 0%,100% { transform: scale(1);} 50% { transform: scale(1.1);} }
@keyframes float { 0%,100% { transform: translateY(0);} 50% { transform: translateY(-12px);} }
</style>
</head>
<body>

<h1>Cattle Breed Identifier</h1>

<label class="upload-container">
  <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
  </svg>
  <span class="upload-text">Upload Image</span>
  <!-- Modern gallery/camera picker -->
  <input type="file" accept="image/*" id="imageUpload" capture="environment">
</label>

<div id="overlay" class="overlay">
  <img src="analyze.gif" alt="Loading...">
  <div class="progress-texts">
    <p id="step1">Uploading Image...</p>
    <p id="step2">Checking Cattle...</p>
    <p id="step3">Analyzing Breed...</p>
    <p id="step4">Fetching Results...</p>
  </div>
  <div class="progress-bar">
    <div id="progressFill" class="progress-fill"></div>
  </div>
</div>

<div id="result" class="result">
  <div id="breed" class="result-header"></div>
  <div class="result-body">
    <p id="origin"></p>
    <p id="lifespan"></p>
    <p id="milkYield"></p>
    <p id="description"></p>
  </div>
</div>

<script>
const overlay = document.getElementById("overlay");
const steps = [
  document.getElementById("step1"),
  document.getElementById("step2"),
  document.getElementById("step3"),
  document.getElementById("step4")
];
const progressFill = document.getElementById("progressFill");

const result = document.getElementById("result");
const breedText = document.getElementById("breed");
const origin = document.getElementById("origin");
const lifespan = document.getElementById("lifespan");
const milkYield = document.getElementById("milkYield");
const description = document.getElementById("description");

const CONFIDENCE_THRESHOLD = 0.5;

const breedInfo = {
  "hallikar": {origin:"Karnataka, India", lifespan:"15-20 years", milkYield:"2-5 liters/day", description:"Known for strength and draught ability."},
  "deoni": {origin:"Maharashtra, Karnataka, Andhra Pradesh", lifespan:"12-15 years", milkYield:"3-8 liters/day", description:"Dual-purpose breed with good resistance."},
  "gir": {origin:"Gujarat, India", lifespan:"12-15 years", milkYield:"10-15 liters/day", description:"Famous for high-quality A2 milk."},
  "jersey": {origin:"Jersey Island, UK", lifespan:"18-22 years", milkYield:"12-20 liters/day", description:"Popular dairy breed producing rich milk."},
  "red sindhi": {origin:"Sindh (Pakistan/India)", lifespan:"12-15 years", milkYield:"8-12 liters/day", description:"Good yield and adaptability."},
  "sahiwal": {origin:"Punjab region", lifespan:"12-15 years", milkYield:"12-18 liters/day", description:"Heat-tolerant and productive."}
};

function showStep(index) {
  steps.forEach((s,i)=>s.classList.toggle("active", i===index));
  progressFill.style.width = `${((index+1)/steps.length)*100}%`;
}

async function runProgress() {
  for (let i=0;i<steps.length;i++){
    showStep(i);
    await new Promise(r=>setTimeout(r,1200));
  }
}

document.getElementById("imageUpload").addEventListener("change", async (e)=>{
  const file = e.target.files[0];
  if(!file) return;

  overlay.classList.add("visible");
  runProgress();

  try {
    const formData = new FormData();
    formData.append("file", file);

    // --- Step 1: Acceptance check ---
    const acceptResponse = await fetch("https://huggingface.co/spaces/shivangggg/class/predict", {method:"POST", body:formData});
    if(!acceptResponse.ok) throw new Error("Acceptance API failed");
    const acceptData = await acceptResponse.json();
    const decision = acceptData[0]?.decision;

    if(decision !== "accept"){
      breedText.textContent = "No Cattle Detected ðŸ˜¯ We know we are smart!";
      origin.textContent=""; lifespan.textContent=""; milkYield.textContent=""; description.textContent="";
      overlay.classList.remove("visible"); result.classList.add("visible");
      return;
    }

    // --- Step 2: Breed identification ---
    const breedResponse = await fetch("https://shivangggg-cow-breed-classifier.hf.space/predict",{method:"POST",body:formData});
    if(!breedResponse.ok) throw new Error("Breed API failed");
    const data = await breedResponse.json();

    let topClass=null, confidence=0;
    if(data.predictions){
      const preds = data.predictions;
      topClass = Object.keys(preds).reduce((a,b)=>preds[a]>preds[b]?a:b);
      confidence = preds[topClass]||0;
    }

    if(confidence>=CONFIDENCE_THRESHOLD){
      const key = topClass.toLowerCase();
      const formattedBreed = key.charAt(0).toUpperCase() + key.slice(1);
      const info = breedInfo[key] || {origin:"-", lifespan:"-", milkYield:"-", description:"No info available for this breed."};
      breedText.textContent = `Identified Breed: ${formattedBreed} (${(confidence*100).toFixed(1)}%)`;
      origin.innerHTML=`Origin: <strong>${info.origin}</strong>`;
      lifespan.innerHTML=`Lifespan: <strong>${info.lifespan}</strong>`;
      milkYield.innerHTML=`Milk Yield: <strong>${info.milkYield}</strong>`;
      description.textContent=`About: ${info.description}`;
    } else {
      breedText.textContent = `Breed not confidently identified (Confidence: ${(confidence*100).toFixed(1)}%)`;
      origin.textContent=""; lifespan.textContent=""; milkYield.textContent=""; description.textContent="";
    }

  } catch(err){
    console.error("Error:",err);
    breedText.textContent="Error: Could not analyze.";
  } finally {
    setTimeout(()=>{ overlay.classList.remove("visible"); result.classList.add("visible"); },500);
  }
});
</script>

</body>
</html>
